<!DOCTYPE html>
<html>
<head>
	<meta charset="$encoding"/>
    <title>IMT-后台接口管理</title>
    <link rel="stylesheet" type="text/css" href="$url/css/simpletree.css"/>
	<script type="text/javascript" src="$url/js/jquery.js"></script>  
	<script type="text/javascript" src="$url/js/simpletree.js"></script>
</head>
<body>

#macro(renderMenu $groups)
	<ul>
	#foreach($group in $groups)
		<li><a href="#" uuid="$group.uuid">$group.name</a></li>
		#if($group.nexts)
			#renderMenu($group.nexts)
		#end
	#end 
	</ul>
#end


#if($authed)
<div style="width: 960px; margin: 30px auto;">
	<div class="st_tree" style="float: left;display: inline;width: 15%; border:1px solid #ccc;">
		#renderMenu($groups)
	</div>
	
	<div style="float:right; display:inline;width: 80%;border:1px solid #ccc; padding:10px;">

			<fieldset style="border:1px solid #ccc; padding:10px;">
			  <legend>&nbsp;执行列表&nbsp;</legend>
				<table>
			    <thead>
					  <tr>
					    <th>接口描述</th>
					    <th>所属类</th>
					    <th>方法名称</th>
					    <th>返回类型</th>
					    <th>参数</th>
					    <th>调用对象id</th>
					    <th>操作</th>
				    </tr>
				</thead>
				
				#foreach($group in $groups)
					#set($group2index = $velocityCount)
					#foreach($nextGroup in $group.nexts)
						<tbody id="group2_${group2index}_data_$velocityCount" style="display:none">
							#foreach($item in $nextGroup.interfaceInfos)
								<form id="form_${nextGroup.uuid}_$velocityCount">
								<tr>
									<td>$item.datas.get(0)</td>
									<td>$item.className</td>
									<td>$item.methodName</td>
									<td>$item.returnClass.getSimpleName()</td>
									<td>
										#set($datasLength = $item.datas.size())
										#foreach($arg in $item.argumentClasses)
											#set($argNum = $velocityCount + 3)
											#if($datasLength >= $argNum + 1)
												$item.datas.get($argNum)
											#else
												$arg.getName();
											#end
											<input type="text" name="arg"/>
										#end
									</td>
									<td>
										<select name="additionalData">
											#foreach($addData in $item.additionalDatas)
												<option value="$addData">$addData</option>
											#end
										</select>
									</td>
									<td>
										<input type="hidden" name="key" value="$!item.key"/>
										<input type="button" class="imt-invoke" formId="form_${nextGroup.uuid}_$velocityCount" value="调用"/>
									</td>
								</tr>
								</form>
							#end
						</tbody>
					#end 
				#end
				</table>
		</fieldset>
		
		<br/>
		
		<fieldset style="border:1px solid #ccc; padding:10px;">
		  <legend>&nbsp;执行结果&nbsp;</legend>
			<div id="imt-div-id-result"></div>
		</fieldset>
	</div>

<br style="clear:both"/>

</div>

<script type="text/javascript">

jQuery(function($) {
	$("#imt_group_1").change(function() {
		//$("#imt_group_2").html($("#" + $(this).val()).clone(true));
		$("select.imt-se-2").hide();
		$("tbody").hide();
		$('#imt-div-id-result').html("");
		$("#" + $(this).val()).show();
	});
	
	$(".imt-se-2").change(function() {
		//$("#imt-tbody").html($("#" + $(this).val()).contents().clone(true));
		$("tbody").hide();
		$('#imt-div-id-result').html("");
		$("#" + $(this).val()).show();
	});
	
	$(".imt-invoke").click(function() {
		var formId = "#" + $(this).attr("formId");

		$["ajax"]({
			type: "POST",
			url: "$url",
			data: $(formId).serialize(),
			cache: false,
			success: function(result){
				$('#imt-div-id-result').html(result);
		  	}
		});
	});
	
	$(".st_tree").SimpleTree({
		click:function(a){
			if(!$(a).attr("hasChild")) {
				$["ajax"]({
					url: "$url/uuid/" + $(a).attr("uuid"),
					success: function(result) {
						alert("success");
						alert(result);
					}
				});
			}
		}
	});
});

</script>

#else
	用户没有登陆，或者没有权限
#end



</body>
</html>